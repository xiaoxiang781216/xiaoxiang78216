name: GitHub User Statistician

# 触发条件：手动触发 + 每天自动更新（可选）
on:
  workflow_dispatch:  # 手动触发（推荐先手动测试）
  schedule:
    - cron: '0 0 * * *'  # 每天 UTC 0 点自动更新（可选）

jobs:
  stats:
    runs-on: ubuntu-latest
    steps:
      # 步骤1：拉取 user-statistician 源码
      - name: Checkout code
        uses: actions/checkout@v4

      # 步骤2：执行 user-statistician Action
      - name: Generate GitHub stats
        uses: cicirello/user-statistician@v1
        with:
          # 必选：你的 PAT（对应刚才配置的 Secrets 名称）
          github-token: ${{ secrets.USER_STAT_TOKEN }}
          # 可选：指定统计年份（这里设为2025，默认是当前年）
          year: 2025
          # 可选：是否包含私有仓库数据（true/false，默认 false）
          include-private: true
          # 可选：生成的统计图表文件名（默认 stats.svg）
          svg-file: github-stats-2025.svg
          # 可选：统计维度（默认全量，这里明确指定关注的维度）
          categories: prs,issues,comments,commits
          # 可选：语言（zh 中文，en 英文，默认 en）
          language: zh

      # 步骤3：将生成的图表提交到仓库
      - name: Commit and push stats
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add github-stats-2025.svg
          # 检查是否有变更，避免空提交
          if git diff --staged --quiet; then
            echo "No changes to commit"
          else
            git commit -m "Update 2025 GitHub stats [skip ci]"
            git push
          fi
